{
  "name": "consolidate_statements",
  "description": "Consolidate individual property financial statements into a combined portfolio view. Aggregates Income Statement, Cash Flow, and Balance Sheet across multiple properties. Handles intercompany elimination of management fees (fees are revenue for the management company and expenses for properties â€” eliminated in consolidation to avoid double-counting). Supports both property-only and full entity consolidation (properties + management company).",
  "input_schema": {
    "type": "object",
    "properties": {
      "consolidation_type": {
        "type": "string",
        "enum": ["properties_only", "full_entity"],
        "description": "'properties_only' aggregates all property SPVs. 'full_entity' adds management company and applies intercompany eliminations."
      },
      "period": {
        "type": "string",
        "description": "Period label (e.g. 'Year 3', 'FY 2028')"
      },
      "property_statements": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "revenue": { "type": "number" },
            "operating_expenses": { "type": "number" },
            "gop": { "type": "number" },
            "management_fees": { "type": "number", "description": "Base + incentive fees paid to mgmt co" },
            "ffe_reserve": { "type": "number" },
            "noi": { "type": "number" },
            "interest_expense": { "type": "number" },
            "depreciation": { "type": "number" },
            "income_tax": { "type": "number" },
            "net_income": { "type": "number" },
            "operating_cash_flow": { "type": "number" },
            "financing_cash_flow": { "type": "number" },
            "ending_cash": { "type": "number" },
            "total_assets": { "type": "number" },
            "total_liabilities": { "type": "number" },
            "total_equity": { "type": "number" }
          },
          "required": ["name", "revenue", "noi", "net_income"]
        }
      },
      "management_company": {
        "type": "object",
        "properties": {
          "fee_revenue": { "type": "number", "description": "Total management fee revenue (should equal sum of property management_fees)" },
          "operating_expenses": { "type": "number" },
          "net_income": { "type": "number" },
          "safe_funding": { "type": "number" },
          "ending_cash": { "type": "number" },
          "total_assets": { "type": "number" },
          "total_liabilities": { "type": "number" },
          "total_equity": { "type": "number" }
        },
        "description": "Required when consolidation_type = 'full_entity'"
      }
    },
    "required": ["consolidation_type", "property_statements"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "consolidated_revenue": { "type": "number" },
      "consolidated_expenses": { "type": "number" },
      "consolidated_noi": { "type": "number" },
      "consolidated_net_income": { "type": "number" },
      "intercompany_eliminations": {
        "type": "object",
        "properties": {
          "management_fees_eliminated": { "type": "number", "description": "Fees eliminated from both revenue (co) and expense (properties)" },
          "fee_linkage_balanced": { "type": "boolean", "description": "True if property fees paid = management company fees received" },
          "variance": { "type": "number" }
        }
      },
      "consolidated_assets": { "type": "number" },
      "consolidated_liabilities": { "type": "number" },
      "consolidated_equity": { "type": "number" },
      "balance_sheet_balanced": { "type": "boolean" },
      "property_count": { "type": "integer" }
    }
  }
}
