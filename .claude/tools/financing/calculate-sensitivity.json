{
  "name": "calculate_sensitivity",
  "description": "Generate a DSCR stress-test matrix across interest rate shocks (basis points) and NOI shocks (percentage changes). For each combination, computes the stressed DSCR and flags whether it meets the minimum threshold. Reports worst-case, best-case, and count of failing scenarios. Uses amortizing (peak) debt service for pass/fail, consistent with standard commercial lending practice.",
  "input_schema": {
    "type": "object",
    "properties": {
      "noi_annual": {
        "type": "number",
        "description": "Base annual Net Operating Income in dollars"
      },
      "loan_amount": {
        "type": "number",
        "description": "Base loan amount in dollars"
      },
      "interest_rate_annual": {
        "type": "number",
        "description": "Base annual interest rate as decimal (e.g. 0.07 = 7%)"
      },
      "amortization_months": {
        "type": "integer",
        "description": "Amortization schedule length in months (e.g. 360 = 30 years)"
      },
      "term_months": {
        "type": "integer",
        "description": "Total loan term in months (e.g. 120 = 10 years)"
      },
      "io_months": {
        "type": "integer",
        "description": "Interest-only period in months (0 = fully amortizing)"
      },
      "rate_shocks_bps": {
        "type": "array",
        "items": { "type": "integer" },
        "description": "Rate variations to test in basis points (e.g. [-200, -100, 0, 100, 200])"
      },
      "noi_shocks_pct": {
        "type": "array",
        "items": { "type": "integer" },
        "description": "NOI variations to test as percentages (e.g. [-20, -10, 0, 10, 20])"
      },
      "min_dscr": {
        "type": "number",
        "description": "Minimum DSCR threshold for pass/fail flagging (default 1.25)"
      }
    },
    "required": ["noi_annual", "loan_amount", "interest_rate_annual", "amortization_months", "term_months"]
  }
}
