{
  "name": "funding_gate_checks",
  "description": "Verify the 5 mandatory business rules (funding gates and financial constraints) that must hold across the entire projection period. (1) Management Company Funding Gate — operations cannot start before SAFE funding. (2) Property Activation Gate — property cannot operate before acquisition/funding. (3) No Negative Cash — cash balances must never go below zero. (4) Debt-Free at Exit — all debt repaid at end of projection. (5) No Over-Distribution — distributions cannot exceed available cash.",
  "input_schema": {
    "type": "object",
    "properties": {
      "entity_type": {
        "type": "string",
        "enum": ["property", "management_company", "portfolio"],
        "description": "Which entity is being checked"
      },
      "entity_name": {
        "type": "string",
        "description": "Name/label for the entity (e.g. property name, 'Management Co')"
      },
      "operations_start_date": {
        "type": "string",
        "description": "Date operations begin (ISO 8601)"
      },
      "funding_date": {
        "type": "string",
        "description": "Date funding is received (acquisition date for property, SAFE tranche date for mgmt co)"
      },
      "monthly_ending_cash": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Array of monthly ending cash balances across the full projection period"
      },
      "final_debt_outstanding": {
        "type": "number",
        "description": "Outstanding debt balance at end of final projection year (should be 0 at exit)"
      },
      "monthly_distributions": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Array of monthly distributions/paybacks to investors (optional, for over-distribution check)"
      }
    },
    "required": ["entity_type", "entity_name", "monthly_ending_cash"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "all_gates_passed": { "type": "boolean" },
      "gates": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "rule": { "type": "string" },
            "description": { "type": "string" },
            "passed": { "type": "boolean" },
            "details": { "type": "string" },
            "severity": { "type": "string", "enum": ["critical", "material", "info"] },
            "first_violation_month": { "type": "integer", "description": "0-based month index of first violation (-1 if none)" }
          }
        }
      },
      "negative_cash_months": {
        "type": "array",
        "items": { "type": "integer" },
        "description": "List of month indices where ending cash < 0"
      },
      "minimum_cash_balance": { "type": "number", "description": "Lowest cash balance observed across all months" }
    }
  }
}
