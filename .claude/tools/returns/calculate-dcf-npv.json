{
  "name": "calculate_dcf_npv",
  "description": "Calculate Discounted Cash Flow (DCF) Net Present Value. Discounts a series of periodic cash flows at a given rate and returns the NPV along with a period-by-period present value timeline. Supports both annual and monthly periodicity. Use to validate IRR (NPV should ≈ 0 at the IRR), compare investment alternatives, or assess whether a property meets a hurdle rate.",
  "input_schema": {
    "type": "object",
    "properties": {
      "cash_flows": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Array of periodic cash flows. Index 0 = time 0 (typically negative for initial investment). Subsequent entries are period-end cash flows."
      },
      "discount_rate": {
        "type": "number",
        "description": "Discount rate per period as a decimal (e.g. 0.10 = 10% annual if cash flows are annual, or 0.00833 for monthly at 10% annual)"
      },
      "periods_per_year": {
        "type": "integer",
        "description": "Number of periods per year (1 = annual cash flows, 12 = monthly). Used only for annualization of results.",
        "default": 1
      },
      "irr_cross_check": {
        "type": "number",
        "description": "Optional IRR to cross-check: NPV at this rate should be ≈ 0. Returns a validation flag if |NPV| > tolerance."
      },
      "tolerance": {
        "type": "number",
        "description": "Tolerance for IRR cross-check validation (default $1.00)",
        "default": 1.0
      }
    },
    "required": ["cash_flows", "discount_rate"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "npv": { "type": "number", "description": "Net Present Value of all cash flows" },
      "pv_timeline": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Present value of each individual cash flow at the discount rate"
      },
      "total_undiscounted": { "type": "number", "description": "Sum of all cash flows without discounting" },
      "annualized_discount_rate": { "type": "number", "description": "Annualized discount rate when periods_per_year > 1 (e.g. monthly rate annualized)" },
      "irr_cross_check_passed": { "type": "boolean", "description": "True if NPV at irr_cross_check rate is within tolerance of zero" }
    }
  }
}
