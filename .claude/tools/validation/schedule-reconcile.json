{
  "name": "schedule_reconcile",
  "description": "Reconcile a debt amortization schedule against the financial engine's monthly outputs. Compares expected interest, principal, total payment, and ending balance from the amortization schedule against actual values in the pro forma. Flags any variances exceeding tolerance, which may indicate a refinance timing mismatch, rounding drift, or calculation bug.",
  "input_schema": {
    "type": "object",
    "properties": {
      "property_name": {
        "type": "string",
        "description": "Property identifier for reporting"
      },
      "schedule": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "month": { "type": "integer", "description": "0-based month index" },
            "expected_interest": { "type": "number" },
            "expected_principal": { "type": "number" },
            "expected_payment": { "type": "number" },
            "expected_ending_balance": { "type": "number" }
          },
          "required": ["month", "expected_interest", "expected_principal", "expected_ending_balance"]
        },
        "description": "Expected amortization schedule entries"
      },
      "engine_outputs": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "month": { "type": "integer" },
            "actual_interest": { "type": "number" },
            "actual_principal": { "type": "number" },
            "actual_payment": { "type": "number" },
            "actual_ending_balance": { "type": "number" }
          },
          "required": ["month", "actual_interest", "actual_principal", "actual_ending_balance"]
        },
        "description": "Actual values from the financial engine's monthly outputs"
      },
      "tolerance": {
        "type": "number",
        "description": "Acceptable variance in dollars (default $0.01 for penny-level precision)",
        "default": 0.01
      }
    },
    "required": ["schedule", "engine_outputs"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "all_reconciled": { "type": "boolean" },
      "total_months_checked": { "type": "integer" },
      "months_with_variances": { "type": "integer" },
      "variances": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "month": { "type": "integer" },
            "field": { "type": "string", "enum": ["interest", "principal", "payment", "ending_balance"] },
            "expected": { "type": "number" },
            "actual": { "type": "number" },
            "variance": { "type": "number" }
          }
        }
      },
      "max_balance_drift": { "type": "number", "description": "Largest absolute ending balance variance observed" },
      "cumulative_interest_variance": { "type": "number", "description": "Total interest variance across all months" }
    }
  }
}
