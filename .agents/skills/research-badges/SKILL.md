---
name: research-badges
description: >
  Gold/amber research badge pattern for displaying AI-researched market values
  alongside user inputs. Use when building or modifying assumption pages, property
  edit forms, financing analysis, or any page where AI-researched data should appear
  next to user-editable fields. Covers the ResearchBadge component, data flow from
  market research, parsing logic, and integration guidelines.
---

# Research Badges — AI-Researched Values Next to User Inputs

> Whenever a page has user-editable assumption fields AND corresponding AI-researched
> market data exists, display the researched value in a gold/amber badge next to the
> input. Clicking the badge applies the researched value.

---

## 1. Visual Design

### Color Palette (Amber/Gold)

| Element         | Tailwind Classes                                           |
| --------------- | ---------------------------------------------------------- |
| Text            | `text-amber-600` (normal), `hover:text-amber-700` (hover) |
| Background      | `bg-amber-50` (normal), `hover:bg-amber-100` (hover)      |
| Border          | `border border-amber-200`                                  |
| Other           | `rounded-md px-1.5 py-0.5 text-xs font-medium`            |
| Cursor          | `cursor-pointer transition-colors`                         |

### On Dark Backgrounds (glass theme)

When used on dark/glass panels, adjust to:

| Element         | Tailwind Classes                                           |
| --------------- | ---------------------------------------------------------- |
| Text            | `text-amber-400` (normal), `hover:text-amber-300` (hover) |
| Background      | `bg-amber-500/10` (normal), `hover:bg-amber-500/20`       |
| Border          | `border border-amber-500/30`                               |

---

## 2. ResearchBadge Component

### Reference Implementation (from `client/src/pages/PropertyEdit.tsx`)

```tsx
function ResearchBadge({ value, onClick }: { value: string | null | undefined; onClick?: () => void }) {
  if (!value) return null;
  return (
    <button
      type="button"
      onClick={onClick}
      className="text-xs font-medium text-amber-600 hover:text-amber-700 bg-amber-50 hover:bg-amber-100 border border-amber-200 rounded-md px-1.5 py-0.5 transition-colors cursor-pointer"
      title="Click to apply research-recommended value"
      data-testid="badge-research"
    >
      (Research: {value})
    </button>
  );
}
```

### Usage Pattern

Place the badge inline with or directly below the field label:

```tsx
<div className="flex items-center gap-2">
  <label>Starting ADR</label>
  <ResearchBadge
    value={researchValues.adr?.display}
    onClick={() => researchValues.adr && handleChange("startAdr", researchValues.adr.mid.toString())}
  />
</div>
<input value={draft.startAdr} onChange={...} />
```

---

## 3. Data Flow

### Where Research Data Comes From

1. **API**: `useMarketResearch("property", propertyId)` hook fetches from `/api/research/:type/:entityId`
2. **Storage**: Research is stored in the `market_research` table with a JSON `content` column
3. **AI Generation**: Research is generated by Claude via `server/aiResearch.ts` tool-use loop

### Research Content Structure

The `content` JSON contains analysis sections. Key fields used for badges:

| Badge Field   | Research Path                                      | Format            |
| ------------- | -------------------------------------------------- | ----------------- |
| ADR           | `content.adrAnalysis.recommendedRange`             | `"$350–$450"`     |
| Occupancy     | `content.occupancyAnalysis.rampUpTimeline`          | Contains `"stabilized occupancy of 65–75%"` |
| Cap Rate      | `content.capRateAnalysis.recommendedRange`          | `"5.5%–7.0%"`     |
| Catering      | `content.cateringAnalysis.recommendedBoostPercent`  | `"25%"`           |
| Land Value    | `content.landValueAnalysis.recommendedPercent`      | `"20%–30%"`       |

### Parsing Logic (from PropertyEdit.tsx)

```tsx
const researchValues = (() => {
  if (!research?.content) return {};
  const c = research.content as any;

  const parseRange = (rangeStr: string | undefined) => {
    if (!rangeStr) return null;
    const nums = rangeStr.replace(/[^0-9.,\-–]/g, ' ')
      .split(/[\s–\-]+/)
      .map(s => parseFloat(s.replace(/,/g, '')))
      .filter(n => !isNaN(n));
    if (nums.length >= 2) return { low: nums[0], high: nums[1], mid: Math.round((nums[0] + nums[1]) / 2) };
    if (nums.length === 1) return { low: nums[0], high: nums[0], mid: nums[0] };
    return null;
  };

  const parsePct = (pctStr: string | undefined) => {
    if (!pctStr) return null;
    const match = pctStr.match(/([\d.]+)/);
    return match ? parseFloat(match[1]) : null;
  };

  const adrRange = parseRange(c.adrAnalysis?.recommendedRange);
  const capRange = parseRange(c.capRateAnalysis?.recommendedRange);
  // ... etc.

  return {
    adr: adrRange ? { display: c.adrAnalysis?.recommendedRange, mid: adrRange.mid } : null,
    capRate: capRange ? { display: c.capRateAnalysis?.recommendedRange, mid: (capRange.low + capRange.high) / 2 } : null,
    // ... etc.
  };
})();
```

---

## 4. Where to Apply Research Badges

### Currently Implemented

- **Property Edit** (`client/src/pages/PropertyEdit.tsx`): ADR, Occupancy, Cap Rate, Catering Boost

### Should Be Added When Building New Pages

Any page with user-editable assumption fields that have corresponding AI research data:

- **Financing Analysis**: When a property is selected, show researched cap rate next to exit cap rate inputs, researched NOI alongside NOI inputs
- **Settings / Global Assumptions**: Company-level research badges for management fee benchmarks, inflation assumptions
- **Property Detail**: Wherever editable financial assumptions appear
- **Any new assumption page**: Always check if research data exists for the field

### Integration Checklist

When adding research badges to a new page:

1. Import or fetch research data via `useMarketResearch(type, entityId)` hook
2. Parse the relevant research content fields using `parseRange()` or `parsePct()`
3. Create a `researchValues` object mapping field names to `{ display, mid }` objects
4. Place `<ResearchBadge>` next to each field that has a corresponding research value
5. Wire `onClick` to apply the `mid` value to the field's state
6. Only render the badge when research data exists (component handles null gracefully)

---

## 5. Design Rules

1. **Never show a badge without data** — the component returns null if `value` is falsy
2. **Always make badges clickable** — clicking applies the midpoint of the researched range
3. **Display format matches the field** — show "$350–$450" for money, "65%–75%" for percentages
4. **Badge text format**: Always use `(Research: {value})` with parentheses
5. **Placement**: Inline with the label, to the right, in the same flex row
6. **Tooltip**: Always include `title="Click to apply research-recommended value"`
7. **On light backgrounds**: Use the amber-600/amber-50 palette
8. **On dark backgrounds**: Use the amber-400/amber-500/10 palette
