{
  "name": "build_irr_cashflow_vector",
  "description": "Construct the correctly structured annual cash flow vector for IRR calculation from property or portfolio financials. Assembles equity investment (negative), yearly Free Cash Flow to Equity, refinancing proceeds, and exit proceeds into a single vector with proper sign conventions. Validates the vector for common errors (missing exit, wrong signs, all-positive/all-negative) before passing to IRR solver.",
  "input_schema": {
    "type": "object",
    "properties": {
      "equity_invested": {
        "type": "number",
        "description": "Total equity invested (positive number; will be negated in Year 0 of vector)"
      },
      "acquisition_year": {
        "type": "integer",
        "description": "0-based year index when acquisition occurs and equity is deployed"
      },
      "yearly_fcfe": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Array of yearly Free Cash Flow to Equity (FCFE) for each projection year. FCFE = Operating CF - Principal Payments"
      },
      "refinancing_proceeds": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Array of refinancing proceeds per year (0 for years without refinance)"
      },
      "exit_proceeds": {
        "type": "number",
        "description": "Net proceeds from property sale in final year (gross sale price - commission - outstanding debt)"
      },
      "projection_years": {
        "type": "integer",
        "description": "Total number of projection years"
      },
      "include_exit": {
        "type": "boolean",
        "description": "Whether to include exit proceeds in final year (default true)",
        "default": true
      }
    },
    "required": ["equity_invested", "acquisition_year", "yearly_fcfe", "projection_years"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "cash_flow_vector": {
        "type": "array",
        "items": { "type": "number" },
        "description": "Assembled cash flow vector ready for IRR solver (Year 0 = -equity, subsequent = FCFE + refi + exit)"
      },
      "validation": {
        "type": "object",
        "properties": {
          "has_negative": { "type": "boolean", "description": "True if vector contains at least one negative flow (required for IRR)" },
          "has_positive": { "type": "boolean", "description": "True if vector contains at least one positive flow (required for IRR)" },
          "has_exit": { "type": "boolean", "description": "True if exit proceeds are included in final year" },
          "sign_changes": { "type": "integer", "description": "Number of sign changes (>1 may indicate multiple IRR solutions)" },
          "is_valid": { "type": "boolean", "description": "True if vector is suitable for IRR calculation" }
        }
      },
      "warnings": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Warnings about potential issues (e.g. 'No exit proceeds in final year', 'Multiple sign changes â€” IRR may have multiple solutions')"
      }
    }
  }
}
