{
  "name": "scenario_compare",
  "description": "Compare two scenario outputs (baseline vs. alternative) and produce a structured delta/variance report. Supports the checker manual Phase 5 (Scenario & Stress Testing) by quantifying the impact of assumption changes on key financial metrics. Highlights which metrics improved, worsened, or remained stable.",
  "input_schema": {
    "type": "object",
    "properties": {
      "baseline_label": {
        "type": "string",
        "description": "Name of the baseline scenario (e.g. 'Base Case', 'Current Assumptions')"
      },
      "alternative_label": {
        "type": "string",
        "description": "Name of the alternative scenario (e.g. 'High Occupancy', 'Recession Stress Test')"
      },
      "assumption_changes": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "field": { "type": "string", "description": "Assumption that was changed" },
            "baseline_value": { "type": "string" },
            "alternative_value": { "type": "string" }
          }
        },
        "description": "List of assumptions that differ between scenarios"
      },
      "baseline_metrics": {
        "type": "object",
        "properties": {
          "total_revenue": { "type": "array", "items": { "type": "number" }, "description": "Yearly total revenue" },
          "noi": { "type": "array", "items": { "type": "number" }, "description": "Yearly NOI" },
          "net_income": { "type": "array", "items": { "type": "number" }, "description": "Yearly net income" },
          "ending_cash": { "type": "array", "items": { "type": "number" }, "description": "Yearly ending cash" },
          "irr": { "type": "number" },
          "equity_multiple": { "type": "number" },
          "average_dscr": { "type": "number" },
          "exit_value": { "type": "number" }
        },
        "required": ["noi", "irr"]
      },
      "alternative_metrics": {
        "type": "object",
        "properties": {
          "total_revenue": { "type": "array", "items": { "type": "number" } },
          "noi": { "type": "array", "items": { "type": "number" } },
          "net_income": { "type": "array", "items": { "type": "number" } },
          "ending_cash": { "type": "array", "items": { "type": "number" } },
          "irr": { "type": "number" },
          "equity_multiple": { "type": "number" },
          "average_dscr": { "type": "number" },
          "exit_value": { "type": "number" }
        },
        "required": ["noi", "irr"]
      }
    },
    "required": ["baseline_label", "alternative_label", "baseline_metrics", "alternative_metrics"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "summary": {
        "type": "object",
        "properties": {
          "irr_delta": { "type": "number", "description": "Change in IRR (basis points)" },
          "irr_direction": { "type": "string", "enum": ["improved", "worsened", "unchanged"] },
          "equity_multiple_delta": { "type": "number" },
          "cumulative_noi_delta": { "type": "number" },
          "cumulative_noi_pct_change": { "type": "number" },
          "exit_value_delta": { "type": "number" }
        }
      },
      "yearly_deltas": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "year": { "type": "integer" },
            "revenue_delta": { "type": "number" },
            "noi_delta": { "type": "number" },
            "net_income_delta": { "type": "number" },
            "cash_delta": { "type": "number" }
          }
        }
      },
      "risk_flags": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Warnings about scenario risks (e.g. 'Alternative scenario produces negative cash in Year 4')"
      },
      "sensitivity_ranking": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "assumption": { "type": "string" },
            "impact_on_irr_bps": { "type": "number", "description": "Estimated IRR impact in basis points" }
          }
        },
        "description": "Ranking of which assumption changes had the largest impact"
      }
    }
  }
}
