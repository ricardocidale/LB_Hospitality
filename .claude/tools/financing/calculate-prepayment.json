{
  "name": "calculate_prepayment",
  "description": "Calculate prepayment penalties for early loan payoff. Supports three penalty types: (1) Yield Maintenance — PV of interest rate differential on remaining scheduled cash flows, (2) Step-Down — fixed percentage that decreases by year (e.g. 5-4-3-2-1), (3) Defeasance — cost of purchasing treasury securities to replicate remaining payments plus admin fees. Returns penalty amount, percentage of balance, and total prepayment cost.",
  "input_schema": {
    "type": "object",
    "properties": {
      "outstanding_balance": {
        "type": "number",
        "description": "Outstanding loan balance at prepayment in dollars"
      },
      "prepayment_month": {
        "type": "integer",
        "description": "Month of prepayment (0-indexed from origination)"
      },
      "loan_rate_annual": {
        "type": "number",
        "description": "Loan origination annual interest rate as decimal (e.g. 0.065 = 6.5%)"
      },
      "term_months": {
        "type": "integer",
        "description": "Total loan term in months"
      },
      "prepayment_type": {
        "type": "string",
        "enum": ["yield_maintenance", "step_down", "defeasance"],
        "description": "Type of prepayment penalty"
      },
      "treasury_rate_annual": {
        "type": "number",
        "description": "Current Treasury rate as annual decimal (e.g. 0.04 = 4%). Required for yield_maintenance and defeasance."
      },
      "step_down_schedule": {
        "type": "array",
        "items": { "type": "number" },
        "description": "For step-down: penalty percentages by year as decimals (e.g. [0.05, 0.04, 0.03, 0.02, 0.01])"
      },
      "defeasance_fee_pct": {
        "type": "number",
        "description": "For defeasance: estimated admin/legal fee as percentage of balance (e.g. 0.01 = 1%)"
      }
    },
    "required": ["loan_rate_annual", "term_months", "prepayment_type"]
  }
}
