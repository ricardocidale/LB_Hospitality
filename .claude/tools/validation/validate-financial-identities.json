{
  "name": "validate_financial_identities",
  "description": "Verify that the three core financial statements (Income Statement, Balance Sheet, Cash Flow Statement) satisfy GAAP accounting identities. Checks: (1) Balance Sheet equation A = L + E, (2) Cash Flow reconciliation OCF + FCF = Net Cash Change, (3) Indirect method OCF = Net Income + Depreciation, (4) Financing CF = -Principal + Refinance Proceeds, (5) Ending Cash = Prior Ending Cash + Net Cash Change. Returns pass/fail per identity with variance amounts.",
  "input_schema": {
    "type": "object",
    "properties": {
      "period_label": {
        "type": "string",
        "description": "Period being validated (e.g. 'Year 3', 'Month 24', 'FY 2028')"
      },
      "balance_sheet": {
        "type": "object",
        "properties": {
          "total_assets": { "type": "number" },
          "total_liabilities": { "type": "number" },
          "total_equity": { "type": "number" }
        },
        "required": ["total_assets", "total_liabilities", "total_equity"]
      },
      "income_statement": {
        "type": "object",
        "properties": {
          "revenue": { "type": "number" },
          "total_expenses": { "type": "number" },
          "gop": { "type": "number" },
          "noi": { "type": "number" },
          "interest_expense": { "type": "number" },
          "depreciation": { "type": "number" },
          "income_tax": { "type": "number" },
          "net_income": { "type": "number" }
        },
        "required": ["noi", "interest_expense", "depreciation", "income_tax", "net_income"]
      },
      "cash_flow_statement": {
        "type": "object",
        "properties": {
          "operating_cash_flow": { "type": "number" },
          "financing_cash_flow": { "type": "number" },
          "net_cash_change": { "type": "number" },
          "beginning_cash": { "type": "number" },
          "ending_cash": { "type": "number" },
          "principal_payment": { "type": "number" },
          "refinancing_proceeds": { "type": "number" }
        },
        "required": ["operating_cash_flow", "financing_cash_flow", "ending_cash"]
      },
      "tolerance": {
        "type": "number",
        "description": "Acceptable rounding tolerance in dollars (default $1.00)",
        "default": 1.0
      }
    },
    "required": ["balance_sheet", "income_statement", "cash_flow_statement"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "all_passed": { "type": "boolean" },
      "checks": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "identity": { "type": "string", "description": "Name of the accounting identity" },
            "formula": { "type": "string", "description": "The mathematical formula being verified" },
            "gaap_reference": { "type": "string", "description": "Relevant GAAP standard (ASC 230, 360, 470)" },
            "expected": { "type": "number" },
            "actual": { "type": "number" },
            "variance": { "type": "number" },
            "passed": { "type": "boolean" },
            "severity": { "type": "string", "enum": ["critical", "material", "minor"] }
          }
        }
      },
      "opinion": { "type": "string", "enum": ["UNQUALIFIED", "QUALIFIED", "ADVERSE"] }
    }
  }
}
